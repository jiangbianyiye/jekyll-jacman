---
layout: post

title: C编程小练习-文件操作

categories: C

tags: C exercise

---

#### 硬盘大文件数据检索

###### 单线程遍历查询

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

void searchStr(char fileToSearch[256],char str[256],char saveFile[256]);

int main()
{
    char str[256]={0};
    scanf("%s",str);//待查询的字符串;
    char fileToSearch[256]="F:\\Class Vedios\\CPP\\大数据相关数据\\开房数据.txt";
    char saveFile[256]={0};
    sprintf(saveFile,"F:\\%s.txt",str);

    time_t start,end;
    time(&start);

    searchStr(fileToSearch,str,saveFile);

    time(&end);
    printf("耗时%f秒\n",difftime(difftime(end,start)));

    system(saveFile);
    system("pause");
    return 0;
}


void searchStr(char fileToSearch[256],char str[256],char saveFile[256])
{
    FILE *pf = fopen(fileToSearch,"r");
    FILE *pfw = fopen(saveFile,"w");

    if(pf==NULL || pfw==NULL){
        printf("can not open file.");
    }
    else{
        char readstr[1024] = {0};
        //feof(pf),表示到达文件尾
        while(!feof(pf)){
            fgets(readstr,1024,pf);//读取一行，缓冲区大小为1024
            char *p = strstr(readstr,str);//查找子字符串
            if(p!=NULL){
                puts(readstr);
                fputs(readstr,pfw);
            }
        }
    }
    fclose(pf);
    fclose(pfw);
    return;
}
```

